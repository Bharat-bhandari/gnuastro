#! /bin/bash
# Update/create authors for the documentation. Run like this:
#
#      ./genauthors top_srcdir top_builddir
#
# This is called by a Makefile that is generated by the GNU Build System,
# the source and build directories might thus be different.
#
#
# Original author:
#     Mohammad Akhlaghi <akhlaghi@gnu.org>
# Contributing author(s):
#     Mosè Giordano <mose@gnu.org>
# Copyright (C) 2016, Free Software Foundation, Inc.
#
# Gnuastro is free software: you can redistribute it and/or modify it under
# the terms of the GNU General Public License as published by the Free
# Software Foundation, either version 3 of the License, or (at your option)
# any later version.
#
# Gnuastro is distributed in the hope that it will be useful, but WITHOUT
# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
# FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for
# more details.
#
# You should have received a copy of the GNU General Public License along
# with Gnuastro. If not, see <http://www.gnu.org/licenses/>.


# Name of output file
name=authors.texi


if [ -d ../.git ]; then
    # Do NOT test if authors.texi is newer than ../.git.  In some cases the
    # list of authors is created empty when running make in top directory
    # (in particular "make -jN" with N > 1), so authors.texi needs to be
    # recreated anyway.
    git shortlog --numbered --summary --email --no-merges          \
        | sed -e 's/</ /' -e 's/>/ /' -e 's/@/@@/' -e "s/è/@\`e/"  \
        | awk '{printf "%s %s (%s, %s)@*\n", $2, $3, $4, $1}' > $2/$name
elif [ -f $1/$name ]; then
    # There is no .git repository (this is a tarball), so if the output
    # file exists in the source directory and the source and build
    # directories are different, then copy the the output file into the
    # build directory.
    #
    # IMPORTANT NOTE: the two conditions are not called together in the
    # elif, otherwise, when the directories are the same, the top `if' will
    # go onto `else' (last resort). If the two directories are the same,
    # then this whole script should be ignored.
    if [ $1 != $2 ]; then cp $1/$name $2/$name; fi
else
    # This is just for a fall-back only for very rare cases, it doesn't
    # need to be regularly updated. Note that because of the HERE document,
    # we had to disobey the indentation. The version, date and output are
    # included here by hand.
    cat > $2/$name <<EOF
As of version 0.0.155-3953 (May 9th, 2016):@*
Mohammad Akhlaghi (akhlaghi@@gnu.org, 230)@*
Mos@\`e Giordano (mose@@gnu.org, 22)@*
EOF
fi
